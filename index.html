<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MountainShares - Rural Economic Development</title>
    <meta name="description" content="MountainShares - Local digital currency for rural economic development. Built on Arbitrum One.">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://mountainshares.com/">
    <meta property="og:title" content="MountainShares - Rural Economic Development">
    <meta property="og:description" content="Local digital currency built on Arbitrum One. Keep money in your community with MountainShares.">
    <meta property="og:image" content="https://i.imgur.com/cLHJYe3.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://mountainshares.com/">
    <meta property="twitter:title" content="MountainShares - Rural Economic Development">
    <meta property="twitter:description" content="Local digital currency built on Arbitrum One. Keep money in your community with MountainShares.">
    <meta property="twitter:image" content="https://i.imgur.com/cLHJYe3.jpg">
    
    <!-- FORCE CACHE REFRESH -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèîÔ∏è</text></svg>">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-526FNHHQ5Y"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-526FNHHQ5Y');
    </script>
    
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    
    <!-- Ethers.js -->
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    
    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <style>
        /* MountainShares Design System */
        :root {
            --ms-gold: #FFD700;
            --ms-blue: #0066FF;
            --ms-sky: #00BFFF;
            --ms-black: #000000;
            --ms-dark: #0A0A0A;
            --ms-gray: #1A1A1A;
            --ms-white: #FFFFFF;
            --ms-gradient: linear-gradient(45deg, #000000, #001122, #0066FF);
            --ms-gold-gradient: linear-gradient(135deg, #FFD700, #FFA500, #FF6B35);
            --ms-premium-gradient: conic-gradient(from 0deg, #FFD700, #0066FF, #FFD700);
        }

        body {
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            background: var(--ms-dark);
            color: var(--ms-white);
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
        }

        /* Dynamic Background Effects */
        body::before {
            content: '';
            background: 
                radial-gradient(circle at 20% 20%, rgba(0, 102, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 70%, rgba(0, 191, 255, 0.05) 0%, transparent 50%);
            animation: dynamicPulse 8s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes dynamicPulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .ms-app {
            max-width: 1800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            min-height: 100vh;
            position: relative;
            border-left: 3px solid var(--ms-gold);
            border-right: 3px solid var(--ms-blue);
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.3);
        }

        /* Header Styles */
        .ms-header {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(26, 26, 26, 0.8));
            backdrop-filter: blur(20px);
            border-bottom: 3px solid transparent;
            border-image: var(--ms-premium-gradient) 1;
            padding: 32px 40px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1600px;
            margin: 0 auto;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .ms-logo {
            width: 80px;
            height: 80px;
            background: conic-gradient(from 0deg, #FFD700, #0066FF, #FFD700);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            animation: logoSpin 6s linear infinite;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.4);
            position: relative;
            overflow: hidden;
        }

        /* Navigation Styles */
        .ms-nav {
            background: linear-gradient(135deg, rgba(42, 42, 42, 0.9), rgba(26, 26, 26, 0.95));
            backdrop-filter: blur(30px);
            border-bottom: 2px solid var(--ms-sky);
            padding: 0 40px;
            position: sticky;
            top: 121px;
            z-index: 900;
        }

        .nav-container {
            display: flex;
            gap: 4px;
            max-width: 1600px;
            margin: 0 auto;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .nav-item {
            flex-shrink: 0;
            padding: 24px 36px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            border-bottom: 4px solid transparent;
            position: relative;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Orbitron', monospace;
        }

        /* Main Content Styles */
        .main-content {
            padding: 64px 40px;
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
        }

        /* Token Purchase Interface */
        .token-purchase {
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.9), rgba(42, 42, 42, 0.7));
            padding: 50px 40px;
            border-radius: 20px;
            margin-bottom: 50px;
        }

        .price-calculator {
            background: rgba(0, 0, 0, 0.3);
            padding: 32px;
            border-radius: 15px;
            margin-bottom: 32px;
        }

        /* Status Indicators */
        .status-online { color: #4CAF50; }
        .status-offline { color: #f44336; }
        .status-checking { color: #ff9800; }
        .status-error { color: #e91e63; }

        /* Responsive Design */
        @media (max-width: 768px) {
            .ms-header, .ms-nav, .main-content {
                padding-left: 20px;
                padding-right: 20px;
            }
            
            .nav-item {
                padding: 16px 24px;
                font-size: 16px;
            }
        }

        /* MountainShares Purchase Interface */
        .purchase-interface {
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.9), rgba(42, 42, 42, 0.7));
            padding: 40px;
            border-radius: 20px;
            margin: 40px 0;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.3);
        }

        .purchase-interface h3 {
            font-size: 32px;
            margin-bottom: 24px;
            color: var(--ms-gold);
        }

        .purchase-form {
            display: flex;
            flex-direction: column;
            gap: 24px;
            max-width: 600px;
            margin: 0 auto;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-group label {
            font-size: 18px;
            color: var(--ms-sky);
        }

        .input-group input {
            padding: 16px;
            border-radius: 10px;
            border: 2px solid var(--ms-sky);
            background: rgba(0, 0, 0, 0.3);
            color: var(--ms-white);
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            border-color: var(--ms-gold);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            outline: none;
        }

        .purchase-button {
            background: var(--ms-gold-gradient);
            color: var(--ms-dark);
            padding: 20px;
            border: none;
            border-radius: 10px;
            font-size: 20px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .purchase-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
        }

        .purchase-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .transaction-status {
            margin-top: 20px;
            padding: 16px;
            border-radius: 10px;
            text-align: center;
            display: none;
        }

        .status-pending {
            background: rgba(255, 152, 0, 0.2);
            color: #ff9800;
        }

        .status-success {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }

        .status-error {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }

        .price-display {
            margin-top: 8px;
            padding: 8px;
            background: rgba(0, 102, 255, 0.1);
            border-radius: 8px;
            color: var(--ms-sky);
            font-size: 16px;
            min-height: 24px;
        }

        .status-actions {
            margin-top: 20px;
            text-align: center;
        }

        .refresh-button {
            background: var(--ms-gold-gradient);
            color: var(--ms-dark);
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .refresh-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .error-message {
            background: rgba(244, 67, 54, 0.1);
            color: #f44336;
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="ms-app">
        <header class="ms-header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="ms-logo">üèîÔ∏è</div>
                    <div class="brand-section">
                        <h1>MountainShares</h1>
                        <div class="business-tagline">Rural Economic Development</div>
                    </div>
                </div>
                <div class="launch-badge">Arbitrum One ‚Ä¢ Live</div>
            </div>
        </header>

        <nav class="ms-nav">
            <div class="nav-container">
                <button class="nav-item active" onclick="showTab('home')">üèîÔ∏è Home</button>
                <button class="nav-item" onclick="showTab('purchase')">üíé Purchase</button>
                <button class="nav-item" onclick="showTab('wallet')">ü¶ä Wallet</button>
                <button class="nav-item" onclick="showTab('status')">üìä Status</button>
            </div>
        </nav>

        <main class="main-content">
            <!-- Home Tab -->
            <div id="home" class="content-tab active">
                <div class="hero-section">
                    <h2>MountainShares on Arbitrum One</h2>
                    <p>Local digital currency that keeps money in your community. Built on Arbitrum One for fast, low-cost transactions.</p>
                    <div class="button-group">
                        <button class="btn-premium btn-primary" onclick="showTab('purchase')">üíé Purchase Tokens</button>
                        <button class="btn-premium btn-secondary" onclick="showTab('wallet')">ü¶ä Connect Wallet</button>
                    </div>
                </div>
            </div>

            <!-- Purchase Tab -->
            <div id="purchase" class="content-tab">
                <div class="purchase-interface">
                    <h3>Purchase MountainShares</h3>
                    <div class="purchase-form">
                        <div class="input-group">
                            <label for="purchase-amount">Amount (ETH)</label>
                            <input type="number" id="purchase-amount" min="0.001" step="0.001" placeholder="Enter amount in ETH">
                            <div id="price-display" class="price-display"></div>
                        </div>
                        <button class="purchase-button" id="purchase-button" onclick="purchaseMountainShares()">Purchase MountainShares</button>
                        <div id="transaction-status" class="transaction-status"></div>
                    </div>
                </div>
            </div>

            <!-- Wallet Tab -->
            <div id="wallet" class="content-tab">
                <div class="wallet-section">
                    <h3>Connect Your Wallet</h3>
                    <div class="wallet-info">
                        <p>Contract Address: <span class="contract-address">0x746dD4D401ce5Bbb0Fc964E1a7b4470619DBf67f</span></p>
                        <p>Network: Arbitrum One</p>
                        <button onclick="connectWallet()">Connect MetaMask</button>
                    </div>
                </div>
            </div>

            <!-- Status Tab -->
            <div id="status" class="content-tab">
                <div class="status-section">
                    <h3>System Status</h3>
                    <div class="status-info">
                        <p>Blockchain: <span id="blockchain-status" class="status-checking">Checking...</span></p>
                        <p>Contract: <span id="contract-status" class="status-checking">Checking...</span></p>
                        <p>Last Updated: <span id="last-updated">--</span></p>
                    </div>
                    <div class="status-actions">
                        <button onclick="updateStatus()" class="refresh-button">üîÑ Refresh Status</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Contract Configuration
        const CONTRACT_ADDRESS = "0x746dD4D401ce5Bbb0Fc964E1a7b4470619DBf67f";
        const CONTRACT_ABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"operationType","type":"string"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"OperationCoordinated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"source","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"RevenueDistributed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"previousAdminRole","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"newAdminRole","type":"bytes32"}],"name":"RoleAdminChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleGranted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleRevoked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"admin","type":"address"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"SystemInitialized","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"recipient","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"string","name":"reason","type":"string"}],"name":"TokensMinted","type":"event"},{"stateMutability":"payable","type":"fallback"},{"inputs":[],"name":"COORDINATOR_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"DEFAULT_ADMIN_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"EMERGENCY_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"HERITAGE_MANAGER_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"businessRegistry","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"coordinateCustomerPurchase","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"creator","type":"address"}],"name":"coordinateHeritageRevenue","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"recipient","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"string","name":"reason","type":"string"}],"name":"coordinateTokenMint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"customerPurchaseContract","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"emergencyPause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"emergencyUnpause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getContractAddresses","outputs":[{"internalType":"address","name":"token","type":"address"},{"internalType":"address","name":"purchase","type":"address"},{"internalType":"address","name":"heritage","type":"address"},{"internalType":"address","name":"treasury","type":"address"},{"internalType":"address","name":"business","type":"address"},{"internalType":"address","name":"oracle","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"}],"name":"getRoleAdmin","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getSystemStatus","outputs":[{"internalType":"bool","name":"initialized","type":"bool"},{"internalType":"bool","name":"paused","type":"bool"},{"internalType":"uint256","name":"operations","type":"uint256"},{"internalType":"uint256","name":"tokensMinted","type":"uint256"},{"internalType":"uint256","name":"revenue","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"grantRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"hasRole","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"heritageContract","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_mountainSharesToken","type":"address"},{"internalType":"address","name":"_customerPurchaseContract","type":"address"},{"internalType":"address","name":"_heritageContract","type":"address"},{"internalType":"address","name":"_treasuryMonitor","type":"address"},{"internalType":"address","name":"_businessRegistry","type":"address"},{"internalType":"address","name":"_priceOracle","type":"address"}],"name":"initializeSystem","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"mountainSharesToken","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"priceOracle","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"renounceRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"revokeRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"systemInitialized","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"systemPaused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalOperations","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalRevenue","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalTokensMinted","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"treasuryMonitor","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"stateMutability":"payable","type":"receive"}];

        let provider, signer, contract;

        // Initialize Web3
        async function initWeb3() {
            if (window.ethereum) {
                try {
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    
                    // Request account access
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    
                    // Check if we're on Arbitrum One
                    const network = await provider.getNetwork();
                    if (network.chainId !== 42161) { // Arbitrum One chainId
                        try {
                            // Try to switch to Arbitrum One
                            await window.ethereum.request({
                                method: 'wallet_switchEthereumChain',
                                params: [{ chainId: '0xA4B1' }], // 42161 in hex
                            });
                        } catch (switchError) {
                            // If Arbitrum One is not added to MetaMask, add it
                            if (switchError.code === 4902) {
                                await window.ethereum.request({
                                    method: 'wallet_addEthereumChain',
                                    params: [{
                                        chainId: '0xA4B1',
                                        chainName: 'Arbitrum One',
                                        nativeCurrency: {
                                            name: 'ETH',
                                            symbol: 'ETH',
                                            decimals: 18
                                        },
                                        rpcUrls: ['https://arb1.arbitrum.io/rpc'],
                                        blockExplorerUrls: ['https://arbiscan.io']
                                    }]
                                });
                            } else {
                                throw switchError;
                            }
                        }
                    }
                    
                    signer = provider.getSigner();
                    contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                    updateStatus();
                    return true;
                } catch (error) {
                    console.error("Error initializing Web3:", error);
                    showTransactionStatus("Error connecting to wallet: " + error.message, "error");
                    return false;
                }
            } else {
                showTransactionStatus("Please install MetaMask to purchase MountainShares.", "error");
                return false;
            }
        }

        // Tab Navigation
        function showTab(tabName) {
            document.querySelectorAll('.content-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
        }

        // Purchase MountainShares
        async function purchaseMountainShares() {
            const amountInput = document.getElementById('purchase-amount');
            const amount = amountInput.value;
            
            if (!amount || amount <= 0) {
                showTransactionStatus("Please enter a valid amount", "error");
                return;
            }

            if (!await initWeb3()) {
                return;
            }

            try {
                showTransactionStatus("Processing purchase...", "pending");
                const purchaseButton = document.getElementById('purchase-button');
                purchaseButton.disabled = true;

                const tx = await contract.coordinateCustomerPurchase({
                    value: ethers.utils.parseEther(amount)
                });

                showTransactionStatus("Transaction submitted! Waiting for confirmation...", "pending");
                
                const receipt = await tx.wait();
                
                showTransactionStatus("Purchase successful! üéâ", "success");
                console.log("Transaction receipt:", receipt);
                updateStatus(); // Update system status after purchase
            } catch (error) {
                console.error("Purchase error:", error);
                showTransactionStatus("Error processing purchase: " + error.message, "error");
            } finally {
                purchaseButton.disabled = false;
            }
        }

        // Show transaction status
        function showTransactionStatus(message, type) {
            const statusDiv = document.getElementById('transaction-status');
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            statusDiv.className = 'transaction-status status-' + type;
        }

        // Status Updates
        async function updateStatus() {
            try {
                const network = await provider.getNetwork();
                const blockchainStatus = document.getElementById('blockchain-status');
                const contractStatus = document.getElementById('contract-status');
                const lastUpdated = document.getElementById('last-updated');
                
                // Update blockchain status
                if (network.chainId === 42161) { // Arbitrum One
                    blockchainStatus.textContent = 'Connected to Arbitrum One';
                    blockchainStatus.className = 'status-online';
                } else {
                    blockchainStatus.textContent = 'Please switch to Arbitrum One';
                    blockchainStatus.className = 'status-error';
                }

                // Update contract status
                const contractCode = await provider.getCode(CONTRACT_ADDRESS);
                if (contractCode !== '0x') {
                    contractStatus.textContent = 'Contract Verified';
                    contractStatus.className = 'status-online';
                } else {
                    contractStatus.textContent = 'Contract Not Found';
                    contractStatus.className = 'status-error';
                }
                
                // Update last updated timestamp
                lastUpdated.textContent = new Date().toLocaleString();
                
                // Remove any error messages
                const errorMessages = document.querySelectorAll('.error-message');
                errorMessages.forEach(msg => msg.remove());
            } catch (error) {
                console.error('Status update failed:', error);
                showTransactionStatus("Error updating status: " + error.message, "error");
            }
        }

        // Connect Wallet
        async function connectWallet() {
            if (await initWeb3()) {
                showTransactionStatus("Wallet connected successfully!", "success");
                showTab('purchase');
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            initWeb3();
            showTab('home');
        });

        document.getElementById('purchase-amount').addEventListener('input', updatePrice);

        function updatePrice() {
            const amount = document.getElementById('purchase-amount').value;
            const priceDisplay = document.getElementById('price-display');
            if (amount && amount > 0) {
                // Example: 1 ETH = 100 MountainShares
                const mountainShares = amount * 100;
                priceDisplay.textContent = `You will receive ${mountainShares} MountainShares`;
            } else {
                priceDisplay.textContent = '';
            }
        }

        function checkPlatformStatus() {
            return true; // Allow purchases now
        }
    </script>
</body>
</html>
