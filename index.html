<!DOCTYPE html>
<html>
<head>
    <title>Appalachian Foodways Resource Hub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root {
            --background: #2d4739;
            --accent: #ffd700;
            --text-light: white;
            --font-body: 'Helvetica Neue', Arial, sans-serif;
        }
        body {
            background: var(--background);
            margin: 0;
            color: var(--text-light);
            font-family: var(--font-body);
        }
        .feed-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .resource-card {
            background: #1e3328;
            border-left: 4px solid var(--accent);
            border-radius: 8px;
            margin: 20px 0;
            padding: 25px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.16);
        }
        .card-title {
            color: var(--accent);
            font-size: 1.5rem;
            margin: 0 0 15px 0;
            border-bottom: 1px solid var(--accent);
            padding-bottom: 10px;
        }
        .card-section {
            margin: 15px 0;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
        }
        .icon-label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
        }
        .payment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin: 15px 0;
        }
        .payment-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        @media (max-width: 768px) {
            .resource-card { padding: 15px; margin: 15px 0; }
            .card-title { font-size: 1.3rem; }
            .payment-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="feed-container" id="feed"></div>
    <script>
        // Configuration
        const featureLayerUrl = "https://services7.arcgis.com/glzyAmcOgJqIUWmg/arcgis/rest/services/service_f2459b3aa83c4162a52c6370048b72ea_form/FeatureServer/0";
        
        // Data Mappings from Choice Lists
        const resourceTypeMap = {
            csa: "CSA Program",
            farmers_market: "Farmers' Market",
            community_garden: "Community Garden",
            food_pantry: "Food Pantry/Bank",
            farm_stand: "Farm Stand",
            restaurant: "Restaurant",
            educational_program: "Educational Program",
            barter_swap: "Barter & Swap Spot",
            preservation: "Traditional Food Preservation",
            community_kitchen: "Community Kitchen"
        };

        const paymentMap = {
            ebt_snap: "EBT/SNAP",
            wic: "WIC",
            sliding_scale: "Sliding Scale",
            barter_trade: "Barter/Trade",
            delivery: "Delivery"
        };

        async function loadFeed() {
            try {
                const response = await fetch(`${featureLayerUrl}/query?where=1=1&outFields=name,city,county,resource_type,business_hours,ebt_snap,wis,sliding_scale,barter_trade,delivery,onsite_production,heritage_crops,web,phone,add_info,CreationDate&orderByFields=CreationDate DESC&f=json`);
                const data = await response.json();
                const feed = document.getElementById("feed");
                feed.innerHTML = "";

                data.features.forEach(feature => {
                    const a = feature.attributes;
                    if (!validateEntry(a)) return;

                    const card = document.createElement("div");
                    card.className = "resource-card";
                    
                    card.innerHTML = `
                        <h2 class="card-title">${a.name}</h2>
                        
                        <div class="card-section">
                            <div class="icon-label">
                                <span>üìç</span>
                                <div>${a.city}, ${a.county}</div>
                            </div>
                            ${a.web ? `<div class="icon-label"><span>üåê</span><a href="${a.web}" style="color:var(--accent)">${a.web}</a></div>` : ''}
                            ${a.phone ? `<div class="icon-label"><span>üìû</span>${a.phone}</div>` : ''}
                        </div>

                        <div class="card-section">
                            <div class="icon-label">
                                <span>üõí</span>
                                <div><strong>${parseResourceType(a.resource_type)}</strong></div>
                            </div>
                            ${a.business_hours ? `<div class="icon-label"><span>‚è∞</span>${a.business_hours}</div>` : ''}
                        </div>

                        <div class="card-section">
                            <div class="payment-grid">
                                ${Object.entries(paymentMap).map(([field, label]) => `
                                    <div class="payment-item">
                                        <span style="color:${a[field] === 'yes' ? 'var(--accent)' : 'white'}">
                                            ${a[field] === 'yes' ? '‚úì' : '‚úó'}
                                        </span>
                                        ${label}
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        ${a.onsite_production === 'yes' ? `
                        <div class="card-section">
                            <div class="icon-label">
                                <span>üå±</span>
                                <div>On-Site Production ${a.heritage_crops === 'yes' ? '(Heritage Crops)' : ''}</div>
                            </div>
                        </div>` : ''}

                        ${a.add_info ? `
                        <div class="card-section">
                            <div class="icon-label">
                                <span>‚≠ê</span>
                                <div>${a.add_info}</div>
                            </div>
                        </div>` : ''}

                        <div style="margin-top:15px; color:var(--accent); font-size:0.9em;">
                            Listed: ${new Date(a.CreationDate).toLocaleDateString()}
                        </div>
                    `;
                    
                    feed.appendChild(card);
                });
            } catch (error) {
                console.error("Error loading feed:", error);
                feed.innerHTML = `<div class="resource-card" style="color:var(--accent)">‚ö†Ô∏è Error loading resource data. Please try again later.</div>`;
            }
        }

        function validateEntry(attributes) {
            return attributes.name && attributes.city && attributes.county && attributes.resource_type;
        }

        function parseResourceType(resourceString) {
            return resourceString.split(';').map(r => resourceTypeMap[r] || r).join(' + ');
        }

        loadFeed();
    </script>
</body>
</html>
