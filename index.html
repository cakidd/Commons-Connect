<!DOCTYPE html>
<html>
<head>
    <title>The Commons Community Feed</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://js.arcgis.com/4.28/"></script>
    <style>
        /* Existing styles remain unchanged */

        /* Enhanced Lightbox Styles */
        .lightbox {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            justify-content: center;
            align-items: center;
        }
        
        .lightbox.active {
            display: flex;
        }

        .lightbox-content {
            max-width: 90%;
            max-height: 90%;
            border: 3px solid var(--accent-gold);
            border-radius: 8px;
            position: relative;
        }

        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent-gold);
            font-size: 40px;
            cursor: pointer;
            padding: 20px;
            user-select: none;
        }

        .lightbox-prev {
            left: 10px;
        }

        .lightbox-next {
            right: 10px;
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 35px;
            color: var(--accent-gold);
            font-size: 40px;
            cursor: pointer;
        }

        .lightbox-loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 4px solid rgba(255,255,255,0.1);
            border-top: 4px solid var(--accent-gold);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            display: none;
        }

        .lightbox-loader.active {
            display: block;
        }

        .lightbox-counter {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--accent-gold);
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <!-- Existing feed container and nav -->

    <!-- Enhanced Lightbox -->
    <div id="lightbox-modal" class="lightbox">
        <span class="lightbox-close">&times;</span>
        <div class="lightbox-loader" id="lightbox-spinner"></div>
        <span class="lightbox-nav lightbox-prev">❮</span>
        <span class="lightbox-nav lightbox-next">❯</span>
        <img class="lightbox-content" id="lightbox-image">
        <div class="lightbox-counter" id="lightbox-counter"></div>
    </div>

    <script>
        // Existing carousel code remains unchanged

        // ======== ENHANCED LIGHTBOX FUNCTIONALITY ========
        const lightbox = document.getElementById('lightbox-modal');
        const lightboxImg = document.getElementById('lightbox-image');
        const lightboxSpinner = document.getElementById('lightbox-spinner');
        const lightboxCounter = document.getElementById('lightbox-counter');
        let currentLightboxImages = [];
        let currentLightboxIndex = 0;
        let touchStartX = 0;

        // Lightbox Controls
        document.querySelectorAll('.lightbox-nav').forEach(btn => {
            btn.addEventListener('click', (e) => {
                if (e.target.classList.contains('lightbox-prev')) {
                    showPrevImage();
                } else {
                    showNextImage();
                }
            });
        });

        // Open lightbox with clicked image
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('feed-photo')) {
                const postIndex = currentPostIndex;
                currentLightboxImages = Array.from(posts[postIndex].querySelectorAll('.feed-photo'))
                    .map(img => img.src);
                currentLightboxIndex = currentLightboxImages.indexOf(e.target.src);
                openLightbox();
            }
        });

        // Swipe handling for lightbox
        lightbox.addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
        });

        lightbox.addEventListener('touchend', e => {
            const touchEndX = e.changedTouches[0].clientX;
            const deltaX = touchEndX - touchStartX;
            if (Math.abs(deltaX) > 50) {
                deltaX > 0 ? showPrevImage() : showNextImage();
            }
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (lightbox.classList.contains('active')) {
                if (e.key === 'ArrowLeft') showPrevImage();
                if (e.key === 'ArrowRight') showNextImage();
                if (e.key === 'Escape') closeLightbox();
            }
        });

        function openLightbox() {
            lightbox.classList.add('active');
            loadImage(currentLightboxIndex);
            updateCounter();
        }

        function closeLightbox() {
            lightbox.classList.remove('active');
            currentLightboxImages = [];
        }

        function showPrevImage() {
            if (currentLightboxIndex > 0) {
                currentLightboxIndex--;
                loadImage(currentLightboxIndex);
                updateCounter();
            }
        }

        function showNextImage() {
            if (currentLightboxIndex < currentLightboxImages.length - 1) {
                currentLightboxIndex++;
                loadImage(currentLightboxIndex);
                updateCounter();
            }
        }

        function loadImage(index) {
            lightboxSpinner.classList.add('active');
            const img = new Image();
            img.onload = () => {
                lightboxImg.src = img.src;
                lightboxSpinner.classList.remove('active');
            };
            img.src = currentLightboxImages[index];
        }

        function updateCounter() {
            lightboxCounter.textContent = `${currentLightboxIndex + 1}/${currentLightboxImages.length}`;
        }

        // Close lightbox handlers remain unchanged
    </script>
</body>
</html>
